apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      if kubectl -n ${NAMESPACE} get sts some-name-datasource-repo-host; then
        echo "expected repo host StatefulSet to not exist"
        exit 1
      fi

      if [[ $(kubectl get job --no-headers -l postgres-operator.crunchydata.com/pgbackrest-backup=replica-create,postgres-operator.crunchydata.com/cluster=some-name-datasource | wc -l) > 0 ]]; then
        echo "expected pgBackRest backup job to not exist"
        exit 1
      fi
