apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      api_key=$(kubectl get -n "${NAMESPACE}" secret monitoring-pmm-secret -o jsonpath='{.data.PMM_SERVER_KEY}' | base64 --decode)
      instance=$(kubectl get -n "${NAMESPACE}" pod -l postgres-operator.crunchydata.com/instance-set=instance1 -o 'jsonpath={.items[].metadata.name}')

      get_metric_values node_boot_time_seconds ${instance} ${api_key}
      get_qan20_values ${instance} ${api_key}
    timeout: 120