apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 60
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      run_psql_local \
        'CREATE DATABASE myapp; \c myapp \\\ CREATE TABLE myTable (id int PRIMARY KEY) USING tde_heap;' \
        "postgres:$(get_psql_user_pass pg-tde-pguser-postgres)@$(get_psql_user_host pg-tde-pguser-postgres)"

      run_psql_local \
        '\c myapp \\\ INSERT INTO myTable (id) VALUES (100500)' \
        "postgres:$(get_psql_user_pass pg-tde-pguser-postgres)@$(get_psql_user_host pg-tde-pguser-postgres)"
