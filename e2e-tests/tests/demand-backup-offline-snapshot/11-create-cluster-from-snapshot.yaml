apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 10
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions
      
      get_cr "cluster-from-snapshot" ${RANDOM} \
        | yq '.spec.instances[0].dataVolumeClaimSpec.dataSource.apiGroup="snapshot.storage.k8s.io"' \
        | yq '.spec.instances[0].dataVolumeClaimSpec.dataSource.kind="VolumeSnapshot"' \
        | yq '.spec.instances[0].dataVolumeClaimSpec.dataSource.name="backup3-pgdata"' \
        | kubectl -n "${NAMESPACE}" apply -f -