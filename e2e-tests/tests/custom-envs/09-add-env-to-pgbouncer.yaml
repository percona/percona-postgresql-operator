apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 10
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions
      kubectl -n "${NAMESPACE}" patch pg custom-envs \
        --type merge \
        -p '{"spec":{"proxy":{"pgBouncer":{"replicas":1,"env":[{"name": "FIRST_ENV", "value": "1000"}, {"name": "SECOND_ENV", "value": "2000"}]}}}}'
          
      sleep 10  
      wait_cluster_consistency custom-envs
        
      check_envs_for_component add pgbouncer FIRST_ENV=1000 SECOND_ENV=2000