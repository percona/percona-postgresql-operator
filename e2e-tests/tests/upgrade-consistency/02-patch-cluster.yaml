apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 30
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      cr_version="2.7.0"
      get_cr \
        | yq eval ".spec.crVersion=\"$cr_version\"" - \ - \
        | yq eval ".spec.image=\"${IMAGE_BASE}:pg-operator-$cr_version-ppg$PG_VER-postgres\"" - \
        | yq eval ".spec.backups.pgbackrest.image=\"${IMAGE_BASE}:pg-operator-$cr_version-pgbackrest$PG_VER\"" - \
        | yq eval ".spec.proxy.pgBouncer.image=\"${IMAGE_BASE}:pg-operator-$cr_version-pgbouncer$PG_VER\"" - \
        | kubectl -n "${NAMESPACE}" apply -f -

      sleep 10
