apiVersion: kuttl.dev/v1beta1
kind: TestStep
timeout: 10
commands:
  - script: |-
      set -o errexit
      set -o xtrace

      source ../../functions

      cr_version="2.7.0"
      get_cr \
        | yq eval ".spec.crVersion=\"$cr_version\"" - \
        | yq eval ".spec.image=\"${IMAGE_BASE}:pg-operator-$cr_version-ppg$PG_VER-postgres\"" - \
        | yq eval ".spec.backups.pgbackrest.image=\"${IMAGE_BASE}:pg-operator-$cr_version-ppg$PG_VER-pgbackrest\"" - \
        | yq eval ".spec.proxy.pgBouncer.image=\"${IMAGE_BASE}:pg-operator-$cr_version-ppg$PG_VER-pgbouncer\"" - \
        | kubectl -n "${NAMESPACE}" apply -f -
